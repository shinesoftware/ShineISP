<?php

/**
 * Statuses
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class Statuses extends BaseStatuses {
	
	/**
	 * Get a list ready for the html select object
	 * 
	 * 
	 * @return array
	 */
	public static function getList($section, $onlypublic = false) {
		$items = array ();
		$dq = Doctrine_Query::create ()->from ( 'Statuses s' )->where ( 's.section = ?', $section );
		
		if ($onlypublic) {
			$dq->addWhere ( 's.public = ?', 1 );
		}
		
		$records = $dq->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );
		
		foreach ( $records as $record ) {
			$items [$record ['status_id']] = $record ['status'];
		}
		
		return $items;
	}
	
	/**
	 * Get the Status ID
	 * 
	 * @param string $status 
	 * @param string $section
	 */
	public static function id($status, $section) {
		
		$record = Doctrine_Query::create ()->from ( 'Statuses s' )
										   ->where ( 'LOWER(s.code) = ?', strtolower($status) )
										   ->addWhere('LOWER(s.section) = ?', strtolower($section) )
										   ->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );
		
		return !empty($record[0]['status_id']) ? $record[0]['status_id'] : null;
	}	
	
	/**
	 * get the label name of the status
	 * 
	 * 
	 * @param integer $status_id
	 */
	public static function getLabel($status_id) {
		$records = Doctrine::getTable ( 'Statuses' )->findBy ( 'status_id', $status_id )->toArray ();
		
		if ($records) {
			$registry = Zend_Registry::getInstance ();
			$translation = $registry->Zend_Translate;
			return $translation->translate ( $records [0] ['status'] );
		}
		return false;
	}
}