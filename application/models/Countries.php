<?php

/**
 * Countries
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 6820 2009-11-30 17:27:49Z jwage $
 */
class Countries extends BaseCountries {
	
	/**
	 * 
	 * Get all the countries
	 */
	public static function findAll() {
		
    	return Doctrine_Query::create ()->from ( 'Countries c' )
           								->orderBy('c.name')
           								->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );		
	}
	
	/**
	 * Find a country by id
	 * 
	 * 
	 * @param unknown_type $id
	 */
	public static function find($id) {
		return Doctrine::getTable ( 'Countries' )->findOneBy ( 'country_id', $id );
	}

	/**
	 * Find by name
	 * 
	 * 
	 * @param unknown_type $name
	 */
	public static function findbyName($name) {
		return Doctrine::getTable ( 'Countries' )->findOneBy ( 'name', $name );
	}

	/**
	 * Find by country code
	 * 
	 * 
	 * @param unknown_type $code
	 */
	public static function findbyCode($code) {
		return Doctrine::getTable ( 'Countries' )->findOneBy ( 'code', $code );
	}

	/**
	 * Find by country name by Id
	 * 
	 * 
	 * @param unknown_type $id
	 */
	public static function getNamebyId($id) {
		$record = Doctrine_Query::create ()->from ( 'Countries c' )
            		    					->where('country_id = ?', $id)
            		    					->limit(1)
            								->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );		
		
		return !empty($record[0]['name']) ? $record[0]['name'] : null;
	}
	
	/**
	 * 
	 * Find by Id 
	 * @param unknown_type $code
	 */
	public static function getIDbyCode($code) {
		if (empty ( $code )) {
			return null;
		}
		$country = Doctrine::getTable ( 'Countries' )->findOneBy ( 'code', $code );
		$country = ! empty ( $country ) ? $country->toArray () : array ();
		return ! empty ( $country ['country_id'] ) ? $country ['country_id'] : null;
	
	}
	
	/**
	 * 
	 * Get the list for the select object
	 */
	public static function getList( $first = false ) {
		$items = array ();
		$records = Doctrine_Query::create ()->from ( 'Countries c' )
            		    					->orderBy('c.name')
            								->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );		
		
        if( $first == true ) {
            $items[0] = '-- Select Country --';
        }
        
		foreach ( $records as $c ) {
			$items [$c ['country_id']] = $c ['name'];
		}
		return $items;
	}
	
	/**
	 * Return true if country is in UE
	 */
	public static function isUEbyId($country_id) {
		if( ! is_numeric($country_id) ) {
			throw new Exception('country id paramenter is mandatory');
		}	
		
		$country      = self::find($country_id);
		$country_code = $country->code;
		
		//* TODO: put this in db and not hardcoded here
		return in_array(strtoupper($country_code), array('AT', 'BE', 'BG', 'CY', 'DK', 'EE', 'FI', 'FR', 'DE', 'GB', 'EL', 'IE', 'IT', 'LV'
												, 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'CZ', 'RO', 'SK', 'SI', 'ES', 'SE', 'HU'
		));
	}
    
    /**
     * Return true if country is IT
     */    
    public static function isITbyId($country_id) {
        if( ! is_numeric($country_id) ) {
            throw new Exception('country id paramenter is mandatory');
        }

        $country      = self::find($country_id);
        $country_code = $country->code;
        if( strtoupper($country_code) == 'IT' ) {
            return true;
        }
            
        return false;
           
    }
}