<?php

/**
 * Taxes
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ##PACKAGE##
 * @subpackage ##SUBPACKAGE##
 * @author     ##NAME## <##EMAIL##>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Taxes extends BaseTaxes
{

	/**
	 * grid
	 * create the configuration of the grid
	 */	
	public static function grid($rowNum = 10) {
		
		$translator = Zend_Registry::getInstance ()->Zend_Translate;
		
		$config ['datagrid'] ['columns'] [] = array ('label' => null, 'field' => 't.tax_id', 'alias' => 'tax_id', 'type' => 'selectall' );
		$config ['datagrid'] ['columns'] [] = array ('label' => $translator->translate ( 'ID' ), 'field' => 't.tax_id', 'alias' => 'tax_id', 'sortable' => true, 'searchable' => true, 'type' => 'string' );
		$config ['datagrid'] ['columns'] [] = array ('label' => $translator->translate ( 'Name' ), 'field' => 'r.name', 'alias' => 'name', 'sortable' => true, 'searchable' => true, 'type' => 'string' );
		$config ['datagrid'] ['columns'] [] = array ('label' => $translator->translate ( 'Percentage' ), 'field' => 'percentage', 'alias' => 'percentage', 'sortable' => true, 'searchable' => true, 'type' => 'string' );
		
		$config ['datagrid'] ['fields'] = "tax_id, name, percentage";
		$config ['datagrid'] ['dqrecordset'] = Doctrine_Query::create ()->select ( $config ['datagrid'] ['fields'] )->from ( 'Taxes t' );
		
		$config ['datagrid'] ['rownum'] = $rowNum;
		
		$config ['datagrid'] ['basepath'] = "/admin/taxes/";
		$config ['datagrid'] ['index'] = "tax_id";
		$config ['datagrid'] ['rowlist'] = array ('10', '50', '100', '1000' );
		
		$config ['datagrid'] ['buttons'] ['edit'] ['label'] = $translator->translate ( 'Edit' );
		$config ['datagrid'] ['buttons'] ['edit'] ['cssicon'] = "edit";
		$config ['datagrid'] ['buttons'] ['edit'] ['action'] = "/admin/taxes/edit/id/%d";
		
		$config ['datagrid'] ['buttons'] ['delete'] ['label'] = $translator->translate ( 'Delete' );
		$config ['datagrid'] ['buttons'] ['delete'] ['cssicon'] = "delete";
		$config ['datagrid'] ['buttons'] ['delete'] ['action'] = "/admin/taxes/delete/id/%d";
		return $config;
	}		
    
    /**
     * find
     * Get a record by ID
     * @param $id
     * @return Doctrine Record
     */
    public static function find($id, $fields = "*", $retarray = false) {
        $dq = Doctrine_Query::create ()->select ( $fields )
        								->from ( 'Taxes t' )
        								->where ( "t.tax_id = ?", $id )
        								->limit ( 1 );
        
        $retarray = $retarray ? Doctrine_Core::HYDRATE_ARRAY : null;
        $record = $dq->execute ( array (), $retarray );
        return $record;
    }	
    
    /**
     * Get the tax percentage by tax_id
     * 
     * @param $id
     * @return Doctrine Record
     */
    public static function get_percentage($tax_id) {
        $record = Doctrine_Query::create ()->select ( 'percentage' )
        								->from ( 'Taxes t' )
        								->where ( "t.tax_id = ?", $tax_id )
        								->limit ( 1 )
        								->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );
        
        return !empty($record['percentage']) ? $record['percentage'] : null;
    }	
    	   
    /**
     * delete
     * Delete a record by ID
     * @param $id
     */
    public static function deleteItem($id) {
        Doctrine::getTable ( 'Taxes' )->findOneBy ( 'tax_id', $id )->delete();
    }
    
	/**
     * getList
     * Get a list ready for the html select object
     * @return array
     */
    public static function getList($empty=false) {
        $items = array ();
        $arrTypes = Doctrine::getTable ( 'Taxes' )->findAll ();
        if($empty){
            $items[] = "";
        }
        foreach ( $arrTypes->getData () as $c ) {
            $items [$c ['tax_id']] = $c ['name'];
        }
        
        return $items;
    }
    
    
    /**
     * getTaxbyTldID
     * Get the tax 
     * @return array
     */
    public static function getTaxbyTldID($tldid) {
        
        $dq = Doctrine_Query::create ()->select('s.tax_id as tax_id, s.name as name, s.percentage as percentage')
        ->from ( 'DomainsTlds dt' )
        ->leftJoin('dt.Taxes s')
        ->where('tld_id = ?', $tldid);
        $tax = $dq->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );
        return isset($tax[0]) ? $tax[0] : null;
    }
    
    /**
     * getTaxbyProductID
     * Get the tax 
     * @return array
     */
    public static function getTaxbyProductID($productid) {
        
        $dq = Doctrine_Query::create ()->select('s.tax_id as tax_id, s.name as name, s.percentage as percentage')->from ( 'Products p' )
        ->leftJoin('p.Taxes s')
        ->where('product_id = ?', $productid);
        $tax = $dq->execute ( array (), Doctrine_Core::HYDRATE_ARRAY );
        return isset($tax[0]) ? $tax[0] : null;
    }
}